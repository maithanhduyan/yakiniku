{% extends "base.html" %}

{% block title %}ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰{% endblock %}
{% block header %}ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰{% endblock %}

{% block content %}
<div class="grid grid-cols-1 lg:grid-cols-4 gap-6 mb-8">
    <!-- Stats Cards -->
    <div class="card p-6">
        <div class="text-3xl font-bold text-primary">{{ stats.total_bookings }}</div>
        <div class="text-gray-400 text-sm">æœ¬æ—¥ã®äºˆç´„</div>
    </div>
    <div class="card p-6">
        <div class="text-3xl font-bold text-green-400">{{ stats.confirmed }}</div>
        <div class="text-gray-400 text-sm">ç¢ºèªæ¸ˆã¿</div>
    </div>
    <div class="card p-6">
        <div class="text-3xl font-bold text-yellow-400">{{ stats.pending }}</div>
        <div class="text-gray-400 text-sm">ç¢ºèªå¾…ã¡</div>
    </div>
    <div class="card p-6">
        <div class="text-3xl font-bold">{{ stats.total_guests }}</div>
        <div class="text-gray-400 text-sm">ç·æ¥å®¢æ•°</div>
    </div>
</div>

<div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- Today's Bookings -->
    <div class="lg:col-span-2">
        <div class="card p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold">ğŸ“… æœ¬æ—¥ã®äºˆç´„ ({{ today.strftime('%m/%d') }})</h3>
                <a href="/admin/bookings" class="text-primary text-sm hover:underline">
                    å…¨ã¦è¦‹ã‚‹ â†’
                </a>
            </div>

            {% if today_bookings %}
            <div class="space-y-3">
                {% for booking in today_bookings %}
                <div class="flex items-center justify-between p-4 bg-gray-800 rounded-lg hover:bg-gray-700 transition cursor-pointer"
                     hx-get="/admin/bookings/{{ booking.id }}"
                     hx-target="#modal-content"
                     hx-trigger="click"
                     onclick="document.getElementById('modal').classList.remove('hidden')">

                    <div class="flex items-center gap-4">
                        <div class="text-xl font-mono text-primary">{{ booking.time }}</div>
                        <div>
                            <div class="font-medium">{{ booking.guest_name }}</div>
                            <div class="text-sm text-gray-400">{{ booking.guests }}åæ§˜</div>
                        </div>
                    </div>

                    <div class="flex items-center gap-3">
                        {% if booking.status == 'confirmed' %}
                        <span class="px-2 py-1 bg-green-900 text-green-300 text-xs rounded">ç¢ºèªæ¸ˆ</span>
                        {% elif booking.status == 'pending' %}
                        <span class="px-2 py-1 bg-yellow-900 text-yellow-300 text-xs rounded">ç¢ºèªå¾…ã¡</span>
                        {% elif booking.status == 'completed' %}
                        <span class="px-2 py-1 bg-blue-900 text-blue-300 text-xs rounded">å®Œäº†</span>
                        {% elif booking.status == 'cancelled' %}
                        <span class="px-2 py-1 bg-red-900 text-red-300 text-xs rounded">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</span>
                        {% endif %}

                        <a href="tel:{{ booking.guest_phone }}"
                           class="text-gray-400 hover:text-primary"
                           onclick="event.stopPropagation()">
                            ğŸ“
                        </a>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="text-center py-12 text-gray-500">
                <div class="text-4xl mb-2">ğŸ“­</div>
                <p>æœ¬æ—¥ã®äºˆç´„ã¯ã‚ã‚Šã¾ã›ã‚“</p>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Quick Actions & Search -->
    <div class="space-y-6">
        <!-- Quick Customer Search -->
        <div class="card p-6">
            <h3 class="text-lg font-bold mb-4">ğŸ” é¡§å®¢æ¤œç´¢</h3>
            <input type="text"
                   name="q"
                   placeholder="é›»è©±ç•ªå· or åå‰..."
                   class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 focus:border-primary focus:outline-none"
                   hx-get="/admin/search"
                   hx-trigger="keyup changed delay:300ms"
                   hx-target="#search-results"
                   hx-include="[name='branch_code']">
            <input type="hidden" name="branch_code" value="{{ branch_code }}">
            <div id="search-results" class="mt-3"></div>
        </div>

        <!-- Upcoming Bookings -->
        <div class="card p-6">
            <h3 class="text-lg font-bold mb-4">ğŸ“† ä»Šå¾Œã®äºˆç´„</h3>
            {% if upcoming_bookings %}
            <div class="space-y-2">
                {% for booking in upcoming_bookings[:5] %}
                <div class="flex justify-between text-sm py-2 border-b border-gray-700 last:border-0">
                    <div>
                        <span class="text-primary">{{ booking.date.strftime('%m/%d') }}</span>
                        <span class="text-gray-400">{{ booking.time }}</span>
                    </div>
                    <div>{{ booking.guest_name }} ({{ booking.guests }}å)</div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p class="text-gray-500 text-sm">äºˆç´„ãªã—</p>
            {% endif %}
        </div>

        <!-- Quick Stats -->
        <div class="card p-6">
            <h3 class="text-lg font-bold mb-4">âš¡ ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</h3>
            <div class="space-y-2">
                <a href="/admin/bookings?booking_date={{ today }}"
                   class="block w-full bg-primary text-black text-center py-2 rounded-lg font-medium hover:bg-yellow-500 transition">
                    æœ¬æ—¥ã®äºˆç´„ã‚’ç®¡ç†
                </a>
                <a href="/admin/customers"
                   class="block w-full bg-gray-700 text-center py-2 rounded-lg hover:bg-gray-600 transition">
                    é¡§å®¢ã‚’æ¤œç´¢
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div id="modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
     onclick="if(event.target === this) this.classList.add('hidden')">
    <div class="bg-[#252525] rounded-lg w-full max-w-2xl max-h-[80vh] overflow-auto m-4">
        <div id="modal-content" class="p-6">
            <!-- Content loaded via HTMX -->
            <div class="text-center py-8 text-gray-500">èª­ã¿è¾¼ã¿ä¸­...</div>
        </div>
    </div>
</div>
{% endblock %}
