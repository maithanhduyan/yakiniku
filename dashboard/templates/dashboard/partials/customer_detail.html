<div class="relative">
    <button class="absolute top-0 right-0 text-gray-400 hover:text-white text-2xl"
            onclick="document.getElementById('modal').classList.add('hidden')">
        Ã—
    </button>

    <!-- Customer Header -->
    <div class="flex items-start justify-between mb-6">
        <div>
            <h3 class="text-2xl font-bold">
                {{ customer.global_customer.name }}
                {% if customer.is_vip %}
                <span class="text-primary">â­</span>
                {% endif %}
            </h3>
            <div class="flex gap-4 mt-2">
                <a href="tel:{{ customer.global_customer.phone }}" class="text-primary hover:underline">
                    ğŸ“ {{ customer.global_customer.phone }}
                </a>
                {% if customer.global_customer.email %}
                <a href="mailto:{{ customer.global_customer.email }}" class="text-gray-400 hover:text-white">
                    âœ‰ï¸ {{ customer.global_customer.email }}
                </a>
                {% endif %}
            </div>
        </div>
        <div class="text-right">
            <div class="text-4xl font-bold text-primary">{{ customer.visit_count }}</div>
            <div class="text-sm text-gray-400">æ¥åº—å›æ•°</div>
        </div>
    </div>

    <!-- VIP Toggle -->
    <div class="mb-6">
        <button class="px-4 py-2 rounded-lg border transition
                       {% if customer.is_vip %}border-primary text-primary{% else %}border-gray-600 text-gray-400 hover:border-primary hover:text-primary{% endif %}"
                hx-put="/admin/customers/{{ customer.id }}/vip"
                hx-target="#vip-status"
                hx-swap="innerHTML">
            {% if customer.is_vip %}â­ VIPä¼šå“¡{% else %}â˜† VIPã«è¨­å®š{% endif %}
        </button>
        <span id="vip-status" class="ml-2 text-sm"></span>
    </div>

    <!-- Preferences -->
    <div class="mb-6">
        <div class="text-sm text-gray-400 mb-2">ãŠå¥½ã¿ãƒ»ãƒ¡ãƒ¢</div>
        <div id="preferences-list" class="flex flex-wrap gap-2 mb-3">
            {% for pref in customer.preferences %}
            {% include "dashboard/partials/preference_tag.html" with context %}
            {% endfor %}
        </div>

        <!-- Add Preference Form -->
        <form hx-post="/admin/customers/{{ customer.id }}/preference"
              hx-target="#preferences-list"
              hx-swap="beforeend"
              class="flex gap-2">
            <input type="text" name="preference"
                   placeholder="ä¾‹: ä¸Šã‚¿ãƒ³å¥½ãã€è¾›ã„ã‚‚ã®è‹¦æ‰‹..."
                   class="flex-1 bg-gray-800 border border-gray-700 rounded px-3 py-2 text-sm focus:border-primary focus:outline-none"
                   required>
            <select name="category" class="bg-gray-800 border border-gray-700 rounded px-3 py-2 text-sm">
                <option value="meat">ğŸ¥© ãŠè‚‰</option>
                <option value="cooking">ğŸ”¥ èª¿ç†æ³•</option>
                <option value="allergy">âš ï¸ ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼</option>
                <option value="occasion">ğŸ‚ ã‚·ãƒ¼ãƒ³</option>
                <option value="other">ğŸ“ ãã®ä»–</option>
            </select>
            <button type="submit" class="px-4 py-2 bg-primary text-black rounded font-medium hover:bg-yellow-500 transition">
                è¿½åŠ 
            </button>
        </form>
    </div>

    <!-- Booking History -->
    <div>
        <div class="text-sm text-gray-400 mb-2">äºˆç´„å±¥æ­´</div>
        <div class="bg-gray-800 rounded-lg overflow-hidden">
            {% if bookings %}
            <table class="w-full text-sm">
                <thead class="bg-gray-700">
                    <tr>
                        <th class="px-4 py-2 text-left">æ—¥ä»˜</th>
                        <th class="px-4 py-2 text-left">æ™‚é–“</th>
                        <th class="px-4 py-2 text-left">äººæ•°</th>
                        <th class="px-4 py-2 text-left">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-700">
                    {% for booking in bookings %}
                    <tr>
                        <td class="px-4 py-2">{{ booking.date.strftime('%Y/%m/%d') }}</td>
                        <td class="px-4 py-2 font-mono text-primary">{{ booking.time }}</td>
                        <td class="px-4 py-2">{{ booking.guests }}å</td>
                        <td class="px-4 py-2">
                            {% if booking.status == 'completed' %}
                            <span class="text-green-400">å®Œäº†</span>
                            {% elif booking.status == 'cancelled' %}
                            <span class="text-red-400">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</span>
                            {% elif booking.status == 'no_show' %}
                            <span class="text-gray-500">No Show</span>
                            {% else %}
                            <span class="text-yellow-400">{{ booking.status }}</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="p-4 text-center text-gray-500">äºˆç´„å±¥æ­´ãªã—</div>
            {% endif %}
        </div>
    </div>

    <div class="text-center mt-6 text-xs text-gray-500">
        é¡§å®¢ID: {{ customer.id[:8] }}...
    </div>
</div>
