<!-- Gantt Timeline Partial - Loaded via HTMX for real-time updates -->
<div class="flex justify-between items-center mb-4">
    <h3 class="text-lg font-bold">ğŸ“Š ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ - {{ target_date.strftime('%m/%d') }}</h3>
    <div class="flex items-center gap-4 text-xs">
        <span class="flex items-center gap-1">
            <span class="w-4 h-3 bg-green-600 rounded"></span> ç¢ºèªæ¸ˆã¿
        </span>
        <span class="flex items-center gap-1">
            <span class="w-4 h-3 bg-yellow-600 rounded"></span> ç¢ºèªå¾…ã¡
        </span>
        <span class="flex items-center gap-1">
            <span class="w-4 h-3 bg-purple-600 rounded"></span> VIP
        </span>
        <span class="flex items-center gap-1">
            <span class="w-4 h-3 bg-gray-600 rounded"></span> ç©ºå¸­
        </span>
        <span class="flex items-center gap-1 ml-2">
            <span class="w-0.5 h-4 bg-red-500"></span> ç¾åœ¨æ™‚åˆ»
        </span>
    </div>
</div>

<div class="overflow-x-auto">
    <div class="min-w-[900px]" id="gantt-timeline">
        <!-- Time Header -->
        <div class="flex border-b border-gray-700 mb-2 relative">
            <div class="w-28 flex-shrink-0 py-2 px-2 text-sm font-bold text-gray-400">ãƒ†ãƒ¼ãƒ–ãƒ«</div>
            <div class="flex-1 flex relative" id="time-header">
                {% for slot in gantt_data.time_slots %}
                <div class="flex-1 text-center py-2 text-xs text-gray-400 border-l border-gray-700
                    {% if loop.index0 % 2 == 0 %}font-bold{% endif %}"
                    data-slot="{{ slot }}">
                    {{ slot }}
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Table Rows -->
        {% if gantt_data.tables %}
        {% for table in gantt_data.tables %}
        <div class="flex items-center border-b border-gray-700/50 hover:bg-gray-700/30 group table-row"
             data-table-id="{{ table.id }}"
             data-table-number="{{ table.table_number }}"
             data-capacity="{{ table.max_capacity }}">
            <!-- Table Info -->
            <div class="w-28 flex-shrink-0 py-3 px-2">
                <div class="flex items-center gap-2">
                    <span class="text-lg">
                        {% if table.table_type == 'private' %}ğŸšª
                        {% elif table.max_capacity >= 6 %}ğŸ›‹ï¸
                        {% else %}ğŸª‘{% endif %}
                    </span>
                    <div>
                        <div class="font-bold text-sm">{{ table.table_number }}</div>
                        <div class="text-xs text-gray-500">{{ table.max_capacity }}å</div>
                    </div>
                </div>
            </div>

            <!-- Timeline Grid (Drop Zone) -->
            <div class="flex-1 flex relative h-12 timeline-dropzone"
                 data-table-id="{{ table.id }}"
                 ondragover="handleDragOver(event)"
                 ondragleave="handleDragLeave(event)"
                 ondrop="handleDrop(event)">
                <!-- Background grid -->
                {% for slot in gantt_data.time_slots %}
                <div class="flex-1 border-l border-gray-700/50 {% if loop.index0 % 2 == 0 %}bg-gray-700/20{% endif %}"></div>
                {% endfor %}

                <!-- Current Time Marker -->
                <div class="current-time-marker absolute top-0 bottom-0 w-0.5 bg-red-500 z-20 pointer-events-none"
                     style="display: none;"></div>

                <!-- Booking Blocks (positioned absolutely) -->
                {% for booking in table.bookings %}
                {% if booking.slot_index >= 0 %}
                {% set slot_width = 100 / gantt_data.time_slots|length %}
                {% set block_left = booking.slot_index * slot_width %}
                {% set block_width = booking.duration_slots * slot_width %}
                <div class="booking-block absolute top-1 bottom-1 rounded-md flex items-center px-2 text-xs font-medium cursor-grab
                    transition-all hover:scale-[1.02] hover:z-10 hover:shadow-lg active:cursor-grabbing
                    {% if booking.status == 'confirmed' %}bg-green-600 hover:bg-green-500
                    {% elif booking.status == 'pending' %}bg-yellow-600 hover:bg-yellow-500
                    {% elif booking.status == 'completed' %}bg-blue-600 hover:bg-blue-500
                    {% else %}bg-purple-600 hover:bg-purple-500{% endif %}"
                    style="left: {{ block_left }}%; width: {{ block_width }}%; min-width: 60px;"
                    title="{{ booking.customer_name }} - {{ booking.guests }}å ({{ booking.time_str }})"
                    draggable="true"
                    data-booking-id="{{ booking.id }}"
                    data-guests="{{ booking.guests }}"
                    data-customer="{{ booking.customer_name }}"
                    data-time="{{ booking.time_str }}"
                    ondragstart="handleDragStart(event)"
                    ondragend="handleDragEnd(event)">
                    <span class="truncate">
                        {{ booking.customer_name[:4] }}{% if booking.customer_name|length > 4 %}..{% endif %}
                        <span class="opacity-75">{{ booking.guests }}å</span>
                    </span>
                </div>
                {% endif %}
                {% endfor %}
            </div>
        </div>
        {% endfor %}
        {% else %}
        <div class="text-center py-8 text-gray-400">
            <p>ãƒ†ãƒ¼ãƒ–ãƒ«ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“</p>
        </div>
        {% endif %}

        <!-- Unassigned Bookings -->
        {% if gantt_data.unassigned_bookings %}
        <div class="mt-4 pt-4 border-t border-gray-600">
            <div class="flex items-center gap-2 mb-2">
                <span class="text-yellow-400">âš ï¸</span>
                <span class="text-sm font-bold text-yellow-400">æœªå‰²å½“ã®äºˆç´„ ({{ gantt_data.unassigned_bookings|length }}ä»¶)</span>
                <span class="text-xs text-gray-500">- ã‚¯ãƒªãƒƒã‚¯ã§ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å‰²ã‚Šå½“ã¦ã€ã¾ãŸã¯ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—</span>
            </div>
            <div class="flex flex-wrap gap-2" id="unassigned-bookings">
                {% for booking in gantt_data.unassigned_bookings %}
                <div class="unassigned-booking px-3 py-2 bg-yellow-900/50 border border-yellow-700 rounded-lg text-sm cursor-grab hover:bg-yellow-800/50 hover:border-yellow-500 transition-all"
                     draggable="true"
                     data-booking-id="{{ booking.id }}"
                     data-guests="{{ booking.guests }}"
                     data-customer="{{ booking.customer_name }}"
                     data-time="{{ booking.time_str }}"
                     onclick="openAssignModal('{{ booking.id }}', '{{ booking.customer_name }}', {{ booking.guests }}, '{{ booking.time_str }}')"
                     ondragstart="handleDragStart(event)"
                     ondragend="handleDragEnd(event)">
                    <span class="font-bold">{{ booking.time_str }}</span>
                    <span class="mx-1">Â·</span>
                    <span>{{ booking.customer_name }}</span>
                    <span class="text-yellow-400">({{ booking.guests }}å)</span>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
</div>

<!-- Current Time Indicator Info -->
<div class="mt-4 pt-4 border-t border-gray-700 flex justify-between text-xs text-gray-400">
    <span>â€» å„äºˆç´„ã¯ç´„90åˆ†ã‚’æƒ³å®š | ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ã§ãƒ†ãƒ¼ãƒ–ãƒ«å¤‰æ›´å¯èƒ½</span>
    <span id="last-update-time">æœ€çµ‚æ›´æ–°: <span class="update-timestamp">{{ target_date.strftime('%Y/%m/%d %H:%M') }}</span></span>
</div>

<script>
// Re-initialize current time marker after HTMX swap
if (typeof updateCurrentTimeMarker === 'function') {
    updateCurrentTimeMarker();
}
</script>
