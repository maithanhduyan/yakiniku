#!/bin/sh
#
# Git pre-commit hook â€” encoding guard
# Checks staged text files for BOM, mojibake, CRLF
#
# Install: copy to .git/hooks/pre-commit (or use pre-commit framework)

# Find the repo root
REPO_ROOT="$(git rev-parse --show-toplevel)"
PYTHON="${REPO_ROOT}/backend/.venv/Scripts/python.exe"

# Fallback for Linux/macOS
if [ ! -f "$PYTHON" ]; then
    PYTHON="${REPO_ROOT}/backend/.venv/bin/python"
fi

if [ ! -f "$PYTHON" ]; then
    PYTHON="python3"
fi

# Force UTF-8 for Python on Windows (prevents CP1252 print crashes)
export PYTHONUTF8=1
export PYTHONIOENCODING=utf-8

# Run encoding check on staged files
exec "$PYTHON" "${REPO_ROOT}/backend/scripts/check_encoding.py" --git-staged
